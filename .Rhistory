return(df)
}
data_churn_na <- generate_missing(data_churn[, -1])
naniar::miss_var_summary(data_churn_na)
data_churn <- bind_cols(
data_churn[, 1],
data_churn_na
)
sum(is.na(data_churn$churn))
recipe_with_shadow <- recipe(churn ~ ., data_churn) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(churn)
recipe_withou_shadow <- recipe(churn ~ ., data_churn) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(churn)
recipe_with_shadow <- recipe(churn ~ ., data_churn) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(churn)
recipe_withou_shadow <- recipe(churn ~ ., data_churn) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(churn)
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
recipe_with_shadow <- recipe(churn ~ ., data_churn) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(all_outcomes())
recipe_withou_shadow <- recipe(churn ~ ., data_churn) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(churn)
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
recipe_with_shadow <- recipe(churn ~ ., data_churn) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(all_outcomes())
recipe_withou_shadow <- recipe(churn ~ ., data_churn) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(all_outcomes())
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
data_churn$churn
recipe_with_shadow <- recipe(churn ~ ., data_churn) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(churn)
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
data("wa_churn")
data_churn <- wa_churn %>%
select(churn, female, senior_citizen, partner,
dependents, tenure, phone_service, contract,
multiple_lines, internet_service, streaming_tv,
streaming_movies, monthly_charges, total_charges)
glimpse(data_churn)
generate_missing <- function(df){
for(i in seq_along(df)){
col <- df[[i]]
n_row <- length(col)
n_random <- n_row * runif(1, 0.01, 0.20)
indices <- round(runif(n_random, 0, n_row), 0)
df[[i]] <- replace(col, indices, NA)
}
return(df)
}
data_churn_na <- generate_missing(data_churn[, -1])
naniar::miss_var_summary(data_churn_na)
data_churn <- bind_cols(
data_churn[, 1],
data_churn_na
) %>%
mutate(churn = ifelse(churn == "yes", 1, 0))
recipe_with_shadow <- recipe(churn ~ ., data_churn) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(churn)
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
data_churn <- bind_cols(
data_churn[, 1],
data_churn_na
) %>%
mutate(churn = ifelse(churn == "yes", "1", "0"))
recipe_with_shadow <- recipe(churn ~ ., data_churn) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(churn)
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
data_churn <- bind_cols(
data_churn[, 1],
data_churn_na
)
data("wa_churn")
data_churn <- wa_churn %>%
select(churn, female, senior_citizen, partner,
dependents, tenure, phone_service, contract,
multiple_lines, internet_service, streaming_tv,
streaming_movies, monthly_charges, total_charges)
glimpse(data_churn)
generate_missing <- function(df){
for(i in seq_along(df)){
col <- df[[i]]
n_row <- length(col)
n_random <- n_row * runif(1, 0.01, 0.20)
indices <- round(runif(n_random, 0, n_row), 0)
df[[i]] <- replace(col, indices, NA)
}
return(df)
}
data_churn_na <- generate_missing(data_churn[, -1])
naniar::miss_var_summary(data_churn_na)
data_churn <- bind_cols(
data_churn[, 1],
data_churn_na
)
data_churn <- bind_cols(
data_churn[, 1],
data_churn_na
)
churn
data_churn
data_churn <- bind_cols(
data_churn[, 1],
data_churn_na
)
data_churn
recipe_with_shadow <- data_churn %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(churn)
# recipe_withou_shadow <- recipe(churn ~ ., data_churn) %>%
#   step_medianimpute(all_numeric()) %>%
#   step_modeimpute(all_nominal()) %>%
#   step_dummy(all_nominal()) %>%
#   step_upsample(all_outcomes())
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
recipe_with_shadow <- data_churn %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors(), -churn) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal()) %>%
step_dummy(all_nominal()) %>%
step_upsample(churn)
# recipe_withou_shadow <- recipe(churn ~ ., data_churn) %>%
#   step_medianimpute(all_numeric()) %>%
#   step_modeimpute(all_nominal()) %>%
#   step_dummy(all_nominal()) %>%
#   step_upsample(all_outcomes())
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
recipe_with_shadow <- data_churn %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
# recipe_withou_shadow <- recipe(churn ~ ., data_churn) %>%
#   step_medianimpute(all_numeric()) %>%
#   step_modeimpute(all_nominal()) %>%
#   step_dummy(all_nominal()) %>%
#   step_upsample(all_outcomes())
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
# recipe_without_shadow_prep <- prep(recipe_withou_shadow, retain = TRUE)
recipe_with_shadow <- data_churn %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
recipe_withou_shadow <- recipe(churn ~ ., data_churn) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(all_outcomes())
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
recipe_without_shadow_prep <- prep(recipe_withou_shadow, retain = TRUE)
split <- initial_split(data_churn, prop = 0.80, strata = "churn")
set.seed(42)
options(max.print = 150)
library(parsnip)
library(tidyverse)
library(recipes)
library(mlbench)
library(rsample)
library(parsnip)
library(tune)
devtools::install_github("tidymodels")
devtools::install_github("tidymodels/recipes")
set.seed(42)
options(max.print = 150)
library(parsnip)
library(tidyverse)
library(recipes)
library(mlbench)
library(rsample)
library(parsnip)
library(tune)
split <- initial_split(data_churn, prop = 0.80, strata = "churn")
df_train <- training(split)
df_test  <- testing(split)
(engine <- rand_forest(
mtry = 2,
trees = 500,
min_n = 10
) %>%
set_mode("classification") %>%
set_engine("ranger"))
recipe_with_shadow <- data_churn %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
recipe_without_shadow <- recipe(churn ~ ., data_churn) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(all_outcomes())
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
recipe_without_shadow_prep <- prep(recipe_without_shadow, retain = TRUE)
recipe_with_shadow <- df_train %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
recipe_without_shadow <- recipe(churn ~ ., df_train) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(all_outcomes())
recipe_with_shadow_prep <- prep(recipe_with_shadow, retain = TRUE)
recipe_without_shadow_prep <- prep(recipe_without_shadow, retain = TRUE)
fit_with_shadow <- fit(churn ~ ., data = juice(recipe_with_shadow_prep))
fit_with_shadow <- engine %>% fit(churn ~ ., data = juice(recipe_with_shadow_prep))
fit_without_shadow <- engine %>% fit(churn ~ ., data = juice(recipe_without_shadow_prep))
fit_with_shadow
pred_with_shadow <- predict(fit_with_shadow, bake(recipe_with_shadow_prep, df_test))
pred_with_shadow
pred_with_shadow <- predict(fit_with_shadow, bake(recipe_with_shadow_prep, df_test), "prob")
pred_without_shadow <- predict(fit_with_shadow, bake(recipe_without_shadow_prep, df_test), "prob")
pred_with_shadow <- predict(fit_with_shadow, bake(recipe_with_shadow_prep, df_test), "prob")
pred_without_shadow <- predict(fit_without_shadow, bake(recipe_without_shadow_prep, df_test), "prob")
library(yardstick)
pred_with_shadow
# roc_auc()
# pred_with_shadow
roc_auc(df_test$churn, pred_with_shadow$.pred_Yes)
?roc_auc()
# pred_with_shadow
roc_auc_vec(df_test$churn, pred_with_shadow$.pred_Yes)
# pred_with_shadow
roc_auc_vec(df_test$churn, pred_with_shadow$.pred_Yes)
roc_auc_vec(df_test$churn, fit_without_shadow$.pred_Yes)
# pred_with_shadow
roc_auc_vec(df_test$churn, pred_with_shadow$.pred_Yes)
roc_auc_vec(df_test$churn, pred_without_shadow$.pred_Yes)
recipe <- df_train %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
recipe_prep <- prep(recipe_with_shadow, retain = TRUE)
juice(recipe_with_shadow_prep)
glimpse(juice(recipe_with_shadow_prep))
(engine <- rand_forest(
mtry = 2,
trees = 500,
min_n = 10
) %>%
set_mode("classification") %>%
set_engine("ranger"))
fit_ <- engine %>% fit(churn ~ ., data = juice(recipe_prep))
(engine <- rand_forest(
mtry = 2,
trees = 500,
min_n = 10
) %>%
set_mode("classification") %>%
set_engine("ranger"))
fit <- engine %>%
fit(churn ~ ., data = juice(recipe_prep))
pred <- predict(fit, bake(recipeprep, df_test), "prob")
recipe <- df_train %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
recipe_prep <- prep(recipe_with_shadow, retain = TRUE)
glimpse(juice(recipe_with_shadow_prep))
(engine <- rand_forest(
mtry = 2,
trees = 500,
min_n = 10
) %>%
set_mode("classification") %>%
set_engine("ranger"))
fit <- engine %>%
fit(churn ~ ., data = juice(recipe_prep))
pred <- predict(fit, bake(recipeprep, df_test), "prob")
(engine <- rand_forest(
mtry = 2,
trees = 500,
min_n = 10
) %>%
set_mode("classification") %>%
set_engine("ranger"))
fit <- engine %>%
fit(churn ~ ., data = juice(recipe_prep))
pred <- predict(fit, bake(recipe_prep, df_test), "prob")
str(fit, max.level = 1)
str(fit$spec, max.level = 1)
str(fit$fit, max.level = 1)
bake(recipe_with_shadow, df_train)
recipe <- df_train %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
recipe_prep <- prep(recipe)
bake(recipe_prep, df_train)
bake(recipe_prep, df_test)
recipe <- df_train %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
recipe_prep <- prep(recipe)
all_equal(
bake(recipe_prep, df_train),
bake(recipe_prep, df_test)
)
recipe <- df_train %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
recipe_prep <- prep(recipe)
all_equal(
bake(recipe_prep, df_train),
bake(recipe_prep, df_test),ignore_row_order = TRUE
)
?all_equal
recipe <- df_train %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
recipe_prep <- prep(recipe)
all_equal(
bake(recipe_prep, df_train),
bake(recipe_prep, df_test),
)
(fit <- rand_forest(
# mtry = 2,
# trees = 500,
# min_n = 10
) %>%
set_mode("classification") %>%
set_engine("ranger"))
fit <- engine %>%
fit(churn ~ ., data = juice(recipe_prep))
pred <- predict(fit, bake(recipe_prep, df_test), "prob")
(fit <- rand_forest() %>%
set_mode("classification") %>%
set_engine("ranger")) %>%
fit(churn ~ ., data = juice(recipe_prep))
pred <- predict(fit, bake(recipe_prep, df_test), "prob")
(fit <- rand_forest() %>%
set_mode("classification") %>%
set_engine("ranger")) %>%
fit(churn ~ ., data = juice(recipe_prep))
pred <- predict(fit, bake(recipe_prep, df_test), "prob")
(fit <- rand_forest() %>%
set_mode("classification") %>%
set_engine("ranger") %>%
fit(churn ~ ., data = juice(recipe_prep)))
pred <- predict(fit, bake(recipe_prep, df_test), "prob")
generate_missing <- function(df){
for(i in seq_along(df)){
if(runif(1, 0, 1) >= 0.50){
col <- df[[i]]
n_row <- length(col)
n_random <- n_row * runif(1, 0.01, 0.20)
indices <- round(runif(n_random, 0, n_row), 0)
df[[i]] <- replace(col, indices, NA)
} else {
next
}
}
return(df)
}
df_churn_na <- generate_missing(df_churn[, -1])
data("wa_churn")
df_churn <- wa_churn %>%
select(churn, female, senior_citizen, partner,
dependents, tenure, phone_service, contract,
multiple_lines, internet_service, streaming_tv,
streaming_movies, monthly_charges, total_charges)
glimpse(df_churn)
df_churn_na <- generate_missing(df_churn[, -1])
naniar::miss_var_summary(df_churn_na)
df_churn <- bind_cols(
df_churn[, 1],
df_churn_na
)
df_churn
split <- initial_split(df_churn, prop = 0.80, strata = "churn")
df_train <- training(split)
df_test  <- testing(split)
recipe <- df_train %>%
recipe(churn ~ .) %>%
step_shadow_missing(all_predictors()) %>%
step_medianimpute(all_numeric()) %>%
step_modeimpute(all_nominal(), -churn) %>%
step_dummy(all_nominal(), -churn) %>%
step_upsample(churn)
recipe_prep <- prep(recipe)
all_equal(
bake(recipe_prep, df_train),
bake(recipe_prep, df_test),
)
(fit <- rand_forest() %>%
set_mode("classification") %>%
set_engine("ranger") %>%
fit(churn ~ ., data = juice(recipe_prep)))
pred <- predict(fit, bake(recipe_prep, df_test), "prob")
train <-
data_frame(
a = c("a", "b", NA),
b = c(NA, "d", "e"),
c = c("f", "g", "h")
)
test <-
data_frame(
a = c(NA, NA, NA),
b = c(NA, "d", "e"),
c = c(NA, "f", "g")
)
rec <- recipe(train) %>%
step_shadow_missing(a, b, c) %>%
prep()
bake(rec, train)
bake(rec, test)
train <-
data_frame(
a = c("a", "b", NA),
b = c(NA, "d", "e"),
c = c("f", "g", "h")
)
test <-
data_frame(
a = c(NA, NA, NA),
b = c(NA, "d", "e"),
c = c(NA, "f", "g")
)
rec <- recipe(train) %>%
step_shadow_missing(a, b, c) %>%
prep()
bake(rec, train)
bake(rec, test)
data("wa_churn")
df_churn <- wa_churn %>%
select(churn, female, senior_citizen, partner,
dependents, tenure, phone_service, contract,
multiple_lines, internet_service, streaming_tv,
streaming_movies, monthly_charges, total_charges)
glimpse(df_churn)
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
